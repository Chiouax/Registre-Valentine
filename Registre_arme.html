<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registre de Vente d'Armes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: #e9ecef;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
        }

        .tab:hover {
            background: #dee2e6;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #3498db;
        }

        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #219a52);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .stat-card h4 {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            font-weight: 600;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .profit-positive {
            color: #27ae60;
            font-weight: bold;
        }

        .profit-negative {
            color: #e74c3c;
            font-weight: bold;
        }

        .info-display {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .delete-btn:hover {
            background: #c0392b;
        }

        .weapons-table {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Registre de Vente d'Armes</h1>
            <p>Syst√®me de gestion et calcul automatique des b√©n√©fices</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('nouvelle-vente')">Nouvelle Vente</button>
            <button class="tab" onclick="showTab('registre')">Registre des Ventes</button>
            <button class="tab" onclick="showTab('base-donnees')">Base de Donn√©es</button>
            <button class="tab" onclick="showTab('statistiques')">Statistiques</button>
            <button class="tab" onclick="showTab('gestion-semaines')">Gestion Semaines</button>
            <button class="tab" onclick="showTab('historique')">Historique</button>
        </div>

        <!-- Nouvelle Vente -->
        <div id="nouvelle-vente" class="tab-content active">
            <div class="form-section">
                <h3>üìù Enregistrer une Nouvelle Vente</h3>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Arme Vendue *</label>
                        <select id="arme-select" onchange="updateArmeInfo()">
                            <option value="">S√©lectionner une arme...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Nom du Client *</label>
                        <input type="text" id="nom-client" placeholder="Nom complet du client">
                    </div>
                    
                    <div class="form-group">
                        <label>Num√©ro de Suivi Client</label>
                        <input type="text" id="num-suivi" placeholder="Ex: CLI001" onblur="verifierNumeroSuivi()">
                        <small id="info-suivi" style="color: #666; font-size: 0.9em;"></small>
                    </div>

                    <div class="form-group">
                        <label>Num√©ro de S√©rie</label>
                        <input type="text" id="num-serie" placeholder="Ex: SN123456">
                    </div>
                    
                    <div class="form-group">
                        <label>Prix de Vente (‚Ç¨) *</label>
                        <input type="number" id="prix-vente" placeholder="Prix de vente" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Date de Vente</label>
                        <input type="date" id="date-vente">
                    </div>
                    
                    <div class="form-group">
                        <label>Vendeur</label>
                        <input type="text" id="vendeur" placeholder="Nom du vendeur">
                    </div>
                </div>

                <div class="info-display" id="arme-info" style="display: none;">
                    <h4>Informations sur l'arme s√©lectionn√©e :</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Taille</div>
                            <div class="info-value" id="info-taille">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Prix de Revient</div>
                            <div class="info-value" id="info-prix-revient">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Prix Client</div>
                            <div class="info-value" id="info-prix-client">-</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">B√©n√©fice Estim√©</div>
                            <div class="info-value" id="info-benefice">-</div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-success" onclick="ajouterVente()">üíæ Enregistrer la Vente</button>
            </div>
        </div>

        <!-- Registre des Ventes -->
        <div id="registre" class="tab-content">
            <h3>üìä Historique des Ventes</h3>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>N¬∞ Suivi</th>
                        <th>N¬∞ S√©rie</th>
                        <th>Arme</th>
                        <th>Client</th>
                        <th>Vendeur</th>
                        <th>Prix de Vente</th>
                        <th>Prix de Revient</th>
                        <th>B√©n√©fice</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="registre-tbody">
                </tbody>
            </table>
        </div>

        <!-- Base de Donn√©es -->
        <div id="base-donnees" class="tab-content">
            <h3>üî´ Base de Donn√©es des Armes</h3>
            <div class="weapons-table">
                <table>
                    <thead>
                        <tr>
                            <th>Nom Arme</th>
                            <th>Taille</th>
                            <th>Prix Revient (‚Ç¨)</th>
                            <th>Prix Client (‚Ç¨)</th>
                            <th>B√©n√©fice Sugg√©r√© (‚Ç¨)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="armes-tbody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Gestion Semaines -->
        <div id="gestion-semaines" class="tab-content">
            <div class="form-section">
                <h3>üìÖ Gestion des Semaines</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Semaine Actuelle</h4>
                        <div class="value" id="semaine-actuelle">Semaine 1</div>
                    </div>
                    <div class="stat-card">
                        <h4>Ventes Cette Semaine</h4>
                        <div class="value" id="ventes-semaine">0</div>
                    </div>
                    <div class="stat-card">
                        <h4>B√©n√©fice Semaine</h4>
                        <div class="value" id="benefice-semaine">0 ‚Ç¨</div>
                    </div>
                </div>

                <div style="text-align: center; margin: 30px 0;">
                    <button class="btn btn-danger" onclick="confirmerResetSemaine()">
                        üîÑ Nouvelle Semaine (Reset Statistiques)
                    </button>
                    <button class="btn" onclick="restaurerBaseDonnees()" style="margin-left: 10px;">
                        üîß Restaurer Base de Donn√©es
                    </button>
                    <p style="margin-top: 10px; color: #666; font-size: 0.9em;">
                        ‚ö†Ô∏è Nouvelle Semaine : Archive la semaine actuelle et r√©initialise les statistiques<br>
                        üîß Restaurer BD : Remet toutes les armes par d√©faut (ne supprime pas les ventes)
                    </p>
                </div>
            </div>
        </div>

        <!-- Statistiques -->
        <div id="statistiques" class="tab-content">
            <h3>üìà Statistiques et Analyses</h3>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Total des Ventes</h4>
                    <div class="value" id="total-ventes">0</div>
                </div>
                <div class="stat-card">
                    <h4>Chiffre d'Affaires</h4>
                    <div class="value" id="chiffre-affaires">0 ‚Ç¨</div>
                </div>
                <div class="stat-card">
                    <h4>B√©n√©fices Totaux</h4>
                    <div class="value" id="benefices-totaux">0 ‚Ç¨</div>
                </div>
                <div class="stat-card">
                    <h4>Marge Moyenne</h4>
                    <div class="value" id="marge-moyenne">0%</div>
                </div>
            </div>

            <h4>Top 5 des Armes les Plus Vendues</h4>
            <table>
                <thead>
                    <tr>
                        <th>Arme</th>
                        <th>Quantit√© Vendue</th>
                        <th>CA Total</th>
                        <th>B√©n√©fice Total</th>
                    </tr>
                </thead>
                <tbody id="top-armes">
                </tbody>
            </table>
        </div>

        <!-- Historique -->
        <div id="historique" class="tab-content">
            <h3>üìö Historique des Semaines</h3>
            <div id="historique-container">
                <!-- Les historiques seront charg√©s ici -->
            </div>
        </div>
    </div>

    <script>
        // Base de donn√©es des armes (bas√©e sur votre tableau)
        let armesData = [
            {nom: "Revolver Gentleman", taille: "Taille 0", prixRevient: 300.3, prixClient: 340, benefice: 39.7},
            {nom: "Revolver Double Action", taille: "Taille 1", prixRevient: 300.3, prixClient: 350, benefice: 49.7},
            {nom: "Revolver Sch√É¬∂field", taille: "Taille 2", prixRevient: 465.9, prixClient: 570, benefice: 104.1},
            {nom: "Revolver Navy", taille: "Taille 2", prixRevient: 525.4, prixClient: 600, benefice: 74.6},
            {nom: "Pistolet Semi Auto", taille: "Taille 3", prixRevient: 660.4, prixClient: 800, benefice: 139.6},
            {nom: "Pistolet M1929", taille: "Taille 3", prixRevient: 734.9, prixClient: 850, benefice: 115.1},
            {nom: "Pistolet Mauser", taille: "Taille 2", prixRevient: 584.9, prixClient: 700, benefice: 115.1},
            {nom: "Pistolet Volcanic", taille: "Taille 2", prixRevient: 465.9, prixClient: 500, benefice: 34.1},
            {nom: "Carabine √É  r√©p√©tition", taille: "Taille 1", prixRevient: 380.9, prixClient: 450, benefice: 69.1},
            {nom: "Carabine Evans", taille: "Taille 3", prixRevient: 764.9, prixClient: 920, benefice: 155.1},
            {nom: "Carabine Litchfield", taille: "Taille 2", prixRevient: 525.4, prixClient: 650, benefice: 124.6},
            {nom: "Carabine Lancaster", taille: "Taille 2", prixRevient: 599.9, prixClient: 750, benefice: 150.1},
            {nom: "Fusil √† petit Gibier", taille: "Taille 1", prixRevient: 425.4, prixClient: 500, benefice: 74.6},
            {nom: "Fusil Springfield", taille: "Taille 3", prixRevient: 675.4, prixClient: 820, benefice: 144.6},
            {nom: "Fusil √† r√©p√©tition", taille: "Taille 3", prixRevient: 765.4, prixClient: 925, benefice: 159.6},
            {nom: "Fusil √† verrou", taille: "Taille 4", prixRevient: 1164.9, prixClient: 1300, benefice: 135.1},
            {nom: "Fusil √† pompe", taille: "Taille 3", prixRevient: 735.4, prixClient: 900, benefice: 164.6},
            {nom: "Fusil √† double canon", taille: "Taille 3", prixRevient: 690.9, prixClient: 850, benefice: 159.1},
            {nom: "Fusil Semis automatique", taille: "Taille 4", prixRevient: 1239.9, prixClient: 1400, benefice: 160.1},
            {nom: "Fusil Rolling Block", taille: "Taille 4", prixRevient: 1164.9, prixClient: 1700, benefice: 535.1},
            {nom: "Fusil √©l√©phant", taille: "Taille 4", prixRevient: 1239.9, prixClient: 1800, benefice: 560.1}
        ];

        // Sauvegarde de la base de donn√©es originale pour restauration
        const armesDataOriginale = [
            {nom: "Revolver Gentleman", taille: "Taille 0", prixRevient: 300.3, prixClient: 340, benefice: 39.7},
            {nom: "Revolver Double Action", taille: "Taille 1", prixRevient: 300.3, prixClient: 350, benefice: 49.7},
            {nom: "Revolver Sch√É¬∂field", taille: "Taille 2", prixRevient: 465.9, prixClient: 570, benefice: 104.1},
            {nom: "Revolver Navy", taille: "Taille 2", prixRevient: 525.4, prixClient: 600, benefice: 74.6},
            {nom: "Pistolet Semi Auto", taille: "Taille 3", prixRevient: 660.4, prixClient: 800, benefice: 139.6},
            {nom: "Pistolet M1929", taille: "Taille 3", prixRevient: 734.9, prixClient: 850, benefice: 115.1},
            {nom: "Pistolet Mauser", taille: "Taille 2", prixRevient: 584.9, prixClient: 700, benefice: 115.1},
            {nom: "Pistolet Volcanic", taille: "Taille 2", prixRevient: 465.9, prixClient: 500, benefice: 34.1},
            {nom: "Carabine √É  r√©p√©tition", taille: "Taille 1", prixRevient: 380.9, prixClient: 450, benefice: 69.1},
            {nom: "Carabine Evans", taille: "Taille 3", prixRevient: 764.9, prixClient: 920, benefice: 155.1},
            {nom: "Carabine Litchfield", taille: "Taille 2", prixRevient: 525.4, prixClient: 650, benefice: 124.6},
            {nom: "Carabine Lancaster", taille: "Taille 2", prixRevient: 599.9, prixClient: 750, benefice: 150.1},
            {nom: "Fusil √† petit Gibier", taille: "Taille 1", prixRevient: 425.4, prixClient: 500, benefice: 74.6},
            {nom: "Fusil Springfield", taille: "Taille 3", prixRevient: 675.4, prixClient: 820, benefice: 144.6},
            {nom: "Fusil √† r√©p√©tition", taille: "Taille 3", prixRevient: 765.4, prixClient: 925, benefice: 159.6},
            {nom: "Fusil √† verrou", taille: "Taille 4", prixRevient: 1164.9, prixClient: 1300, benefice: 135.1},
            {nom: "Fusil √† pompe", taille: "Taille 3", prixRevient: 735.4, prixClient: 900, benefice: 164.6},
            {nom: "Fusil √† double canon", taille: "Taille 3", prixRevient: 690.9, prixClient: 850, benefice: 159.1},
            {nom: "Fusil Semis automatique", taille: "Taille 4", prixRevient: 1239.9, prixClient: 1400, benefice: 160.1},
            {nom: "Fusil Rolling Block", taille: "Taille 4", prixRevient: 1164.9, prixClient: 1700, benefice: 535.1},
            {nom: "Fusil √©l√©phant", taille: "Taille 4", prixRevient: 1239.9, prixClient: 1800, benefice: 560.1}
        ];

        // Stockage local des ventes et historique
        let ventes = JSON.parse(localStorage.getItem('ventes') || '[]');
        let historiquesSemaines = JSON.parse(localStorage.getItem('historiquesSemaines') || '[]');
        let numerosSuivi = JSON.parse(localStorage.getItem('numerosSuivi') || '{}');

        // Prix des mat√©riaux
        const prixMateriaux = {
            acier: 1.5,
            cuivre: 0.89,
            vernis: 0.25,
            bois: 0.4
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Charger les armes depuis le stockage ou utiliser les valeurs par d√©faut
            const armesStockees = localStorage.getItem('armesData');
            if (armesStockees) {
                armesData = JSON.parse(armesStockees);
            }
            
            // Date du jour par d√©faut
            document.getElementById('date-vente').value = new Date().toISOString().split('T')[0];
            
            // Charger les options d'armes
            chargerArmes();
            
            // Afficher les donn√©es
            afficherArmes();
            afficherRegistre();
            calculerStatistiques();
            afficherHistorique();
            mettreAJourInfosSemaine();
        });

        function showTab(tabName) {
            // Masquer tous les contenus
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // D√©sactiver tous les onglets
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activer l'onglet s√©lectionn√©
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function chargerArmes() {
            const select = document.getElementById('arme-select');
            select.innerHTML = '<option value="">S√©lectionner une arme...</option>';
            
            armesData.forEach((arme, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = arme.nom;
                select.appendChild(option);
            });
        }

        function updateArmeInfo() {
            const select = document.getElementById('arme-select');
            const infoDiv = document.getElementById('arme-info');
            const prixVenteInput = document.getElementById('prix-vente');
            
            if (select.value === '') {
                infoDiv.style.display = 'none';
                return;
            }
            
            const arme = armesData[parseInt(select.value)];
            
            document.getElementById('info-taille').textContent = arme.taille;
            document.getElementById('info-prix-revient').textContent = arme.prixRevient.toFixed(2) + ' ‚Ç¨';
            document.getElementById('info-prix-client').textContent = arme.prixClient.toFixed(2) + ' ‚Ç¨';
            
            // Suggestion de prix de vente
            const prixSuggere = arme.prixClient;
            prixVenteInput.value = prixSuggere.toFixed(2);
            
            // Calcul du b√©n√©fice avec le prix sugg√©r√©
            const beneficeEstime = prixSuggere - arme.prixRevient;
            document.getElementById('info-benefice').textContent = beneficeEstime.toFixed(2) + ' ‚Ç¨';
            
            infoDiv.style.display = 'block';
        }

        function verifierNumeroSuivi() {
            const numSuivi = document.getElementById('num-suivi').value;
            const infoSuivi = document.getElementById('info-suivi');
            
            if (numSuivi && numerosSuivi[numSuivi]) {
                const client = numerosSuivi[numSuivi];
                document.getElementById('nom-client').value = client.nom;
                infoSuivi.textContent = `Client existant: ${client.nom} (${client.totalAchats} achats)`;
                infoSuivi.style.color = '#27ae60';
            } else if (numSuivi) {
                infoSuivi.textContent = 'Nouveau num√©ro de suivi';
                infoSuivi.style.color = '#3498db';
            } else {
                infoSuivi.textContent = '';
            }
        }

        function ajouterVente() {
            const armeIndex = document.getElementById('arme-select').value;
            const nomClient = document.getElementById('nom-client').value;
            const numSuivi = document.getElementById('num-suivi').value;
            const numSerie = document.getElementById('num-serie').value;
            const prixVente = parseFloat(document.getElementById('prix-vente').value);
            const dateVente = document.getElementById('date-vente').value;
            const vendeur = document.getElementById('vendeur').value;
            
            if (!armeIndex || !nomClient || !prixVente) {
                alert('Veuillez remplir tous les champs obligatoires (*)');
                return;
            }
            
            const arme = armesData[parseInt(armeIndex)];
            const benefice = prixVente - arme.prixRevient;
            
            // Mettre √† jour ou cr√©er le num√©ro de suivi
            if (numSuivi) {
                if (!numerosSuivi[numSuivi]) {
                    numerosSuivi[numSuivi] = {
                        nom: nomClient,
                        totalAchats: 0,
                        premiereVente: dateVente
                    };
                }
                numerosSuivi[numSuivi].totalAchats++;
                numerosSuivi[numSuivi].derniereVente = dateVente;
                localStorage.setItem('numerosSuivi', JSON.stringify(numerosSuivi));
            }
            
            const nouvelleVente = {
                id: Date.now(),
                date: dateVente,
                numSuivi: numSuivi,
                numSerie: numSerie,
                arme: arme.nom,
                client: nomClient,
                vendeur: vendeur,
                prixVente: prixVente,
                prixRevient: arme.prixRevient,
                benefice: benefice
            };
            
            ventes.unshift(nouvelleVente);
            localStorage.setItem('ventes', JSON.stringify(ventes));
            
            // R√©initialiser le formulaire
            document.getElementById('arme-select').value = '';
            document.getElementById('nom-client').value = '';
            document.getElementById('num-suivi').value = '';
            document.getElementById('num-serie').value = '';
            document.getElementById('prix-vente').value = '';
            document.getElementById('vendeur').value = '';
            document.getElementById('arme-info').style.display = 'none';
            document.getElementById('info-suivi').textContent = '';
            
            // Actualiser les affichages
            afficherRegistre();
            calculerStatistiques();
            mettreAJourInfosSemaine();
            
            alert('Vente enregistr√©e avec succ√®s !');
            showTab('registre');
        }

        function afficherArmes() {
            const tbody = document.getElementById('armes-tbody');
            tbody.innerHTML = '';
            
            armesData.forEach((arme, index) => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${arme.nom}</td>
                    <td>${arme.taille}</td>
                    <td>${arme.prixRevient.toFixed(2)} ‚Ç¨</td>
                    <td>
                        <input type="number" value="${arme.prixClient.toFixed(2)}" 
                               onchange="modifierPrixClient(${index}, this.value)" 
                               style="width: 80px; padding: 4px; border: 1px solid #ddd; border-radius: 4px;">
                    </td>
                    <td>${arme.benefice.toFixed(2)} ‚Ç¨</td>
                    <td>
                        <button class="delete-btn" onclick="supprimerArme(${index})">Supprimer</button>
                        <button class="btn" onclick="restaurerArme(${index})" style="padding: 4px 8px; font-size: 0.8rem; margin-left: 5px;">Restaurer</button>
                    </td>
                `;
            });
        }

        function afficherRegistre() {
            const tbody = document.getElementById('registre-tbody');
            tbody.innerHTML = '';
            
            ventes.forEach(vente => {
                const row = tbody.insertRow();
                const profitClass = vente.benefice >= 0 ? 'profit-positive' : 'profit-negative';
                
                row.innerHTML = `
                    <td>${vente.date}</td>
                    <td>${vente.numSuivi || '-'}</td>
                    <td>${vente.numSerie || '-'}</td>
                    <td>${vente.arme}</td>
                    <td>${vente.client}</td>
                    <td>${vente.vendeur || '-'}</td>
                    <td>${vente.prixVente.toFixed(2)} ‚Ç¨</td>
                    <td>${vente.prixRevient.toFixed(2)} ‚Ç¨</td>
                    <td class="${profitClass}">${vente.benefice.toFixed(2)} ‚Ç¨</td>
                    <td><button class="delete-btn" onclick="supprimerVente(${vente.id})">Supprimer</button></td>
                `;
            });
        }

        function supprimerVente(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette vente ?')) {
                ventes = ventes.filter(vente => vente.id !== id);
                localStorage.setItem('ventes', JSON.stringify(ventes));
                afficherRegistre();
                calculerStatistiques();
                mettreAJourInfosSemaine();
            }
        }

        function modifierPrixClient(index, nouveauPrix) {
            const prix = parseFloat(nouveauPrix);
            if (!isNaN(prix) && prix > 0) {
                armesData[index].prixClient = prix;
                localStorage.setItem('armesData', JSON.stringify(armesData));
                chargerArmes();
                alert('Prix client modifi√© avec succ√®s !');
            } else {
                alert('Veuillez entrer un prix valide');
                afficherArmes();
            }
        }

        function supprimerArme(index) {
            const arme = armesData[index];
            if (confirm(`√ätes-vous s√ªr de vouloir supprimer "${arme.nom}" de la base de donn√©es ?`)) {
                armesData.splice(index, 1);
                localStorage.setItem('armesData', JSON.stringify(armesData));
                afficherArmes();
                chargerArmes();
                alert('Arme supprim√©e avec succ√®s !');
            }
        }

        function restaurerArme(index) {
            const armeOriginale = armesDataOriginale[index];
            if (armeOriginale && confirm(`Restaurer "${armeOriginale.nom}" avec les valeurs par d√©faut ?`)) {
                const existeIndex = armesData.findIndex(a => a.nom === armeOriginale.nom);
                
                if (existeIndex !== -1) {
                    armesData[existeIndex] = {...armeOriginale};
                } else {
                    armesData.splice(index, 0, {...armeOriginale});
                }
                
                localStorage.setItem('armesData', JSON.stringify(armesData));
                afficherArmes();
                chargerArmes();
                alert('Arme restaur√©e avec succ√®s !');
            }
        }

        function calculerStatistiques() {
            const totalVentes = ventes.length;
            const chiffredAffaires = ventes.reduce((sum, vente) => sum + vente.prixVente, 0);
            const beneficesTotaux = ventes.reduce((sum, vente) => sum + vente.benefice, 0);
            const margeMoyenne = chiffredAffaires > 0 ? (beneficesTotaux / chiffredAffaires) * 100 : 0;
            
            document.getElementById('total-ventes').textContent = totalVentes;
            document.getElementById('chiffre-affaires').textContent = chiffredAffaires.toFixed(2) + ' ‚Ç¨';
            document.getElementById('benefices-totaux').textContent = beneficesTotaux.toFixed(2) + ' ‚Ç¨';
            document.getElementById('marge-moyenne').textContent = margeMoyenne.toFixed(1) + '%';
            
            // Top des armes
            const armeStats = {};
            ventes.forEach(vente => {
                if (!armeStats[vente.arme]) {
                    armeStats[vente.arme] = {
                        quantite: 0,
                        ca: 0,
                        benefice: 0
                    };
                }
                armeStats[vente.arme].quantite++;
                armeStats[vente.arme].ca += vente.prixVente;
                armeStats[vente.arme].benefice += vente.benefice;
            });
            
            const topArmes = Object.entries(armeStats)
                .sort((a, b) => b[1].quantite - a[1].quantite)
                .slice(0, 5);
                
            const topTbody = document.getElementById('top-armes');
            topTbody.innerHTML = '';
            
            topArmes.forEach(([nom, stats]) => {
                const row = topTbody.insertRow();
                row.innerHTML = `
                    <td>${nom}</td>
                    <td>${stats.quantite}</td>
                    <td>${stats.ca.toFixed(2)} ‚Ç¨</td>
                    <td>${stats.benefice.toFixed(2)} ‚Ç¨</td>
                `;
            });
        }

        function mettreAJourInfosSemaine() {
            const numeroSemaine = historiquesSemaines.length + 1;
            document.getElementById('semaine-actuelle').textContent = `Semaine ${numeroSemaine}`;
            document.getElementById('ventes-semaine').textContent = ventes.length;
            
            const beneficeSemaine = ventes.reduce((sum, vente) => sum + vente.benefice, 0);
            document.getElementById('benefice-semaine').textContent = beneficeSemaine.toFixed(2) + ' ‚Ç¨';
        }

        function confirmerResetSemaine() {
            if (ventes.length === 0) {
                alert('Aucune vente √† archiver pour cette semaine.');
                return;
            }

            const confirmation = confirm(
                `√ätes-vous s√ªr de vouloir commencer une nouvelle semaine ?\n\n` +
                `Cette action va :\n` +
                `‚úÖ Archiver les ${ventes.length} ventes actuelles\n` +
                `‚úÖ Conserver tous les num√©ros de suivi clients\n` +
                `üîÑ Remettre √† z√©ro les statistiques de vente\n\n` +
                `Cette action ne peut pas √™tre annul√©e.`
            );

            if (confirmation) {
                nouvelleSemaine();
            }
        }

        function nouvelleSemaine() {
            const numeroSemaine = historiquesSemaines.length + 1;
            const totalVentes = ventes.length;
            const chiffredAffaires = ventes.reduce((sum, vente) => sum + vente.prixVente, 0);
            const beneficesTotaux = ventes.reduce((sum, vente) => sum + vente.benefice, 0);
            
            const nouvelleSemaineHistorique = {
                numero: numeroSemaine,
                dateCreation: new Date().toISOString().split('T')[0],
                totalVentes: totalVentes,
                chiffredAffaires: chiffredAffaires,
                beneficesTotaux: beneficesTotaux,
                margeMoyenne: chiffredAffaires > 0 ? (beneficesTotaux / chiffredAffaires) * 100 : 0,
                ventes: [...ventes]
            };

            historiquesSemaines.push(nouvelleSemaineHistorique);
            localStorage.setItem('historiquesSemaines', JSON.stringify(historiquesSemaines));

            ventes = [];
            localStorage.setItem('ventes', JSON.stringify(ventes));

            afficherRegistre();
            calculerStatistiques();
            afficherHistorique();
            mettreAJourInfosSemaine();

            alert(`Nouvelle semaine cr√©√©e ! Semaine ${numeroSemaine} archiv√©e avec succ√®s.`);
            showTab('gestion-semaines');
        }

        function restaurerBaseDonnees() {
            if (confirm('√ätes-vous s√ªr de vouloir restaurer la base de donn√©es aux valeurs par d√©faut ?\n\nCela va :\n‚úÖ Restaurer toutes les armes supprim√©es\n‚úÖ Remettre les prix par d√©faut\n‚ùå Ne pas affecter vos ventes ou historiques')) {
                armesData = armesDataOriginale.map(a => ({...a}));
                localStorage.setItem('armesData', JSON.stringify(armesData));
                
                afficherArmes();
                chargerArmes();
                
                alert('Base de donn√©es restaur√©e avec succ√®s !');
            }
        }

        function afficherHistorique() {
            const container = document.getElementById('historique-container');
            
            if (historiquesSemaines.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 50px;">Aucun historique disponible. Commencez par cr√©er une nouvelle semaine.</p>';
                return;
            }

            let html = '';
            
            [...historiquesSemaines].reverse().forEach(semaine => {
                html += `
                    <div class="form-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h4>üìÖ Semaine ${semaine.numero} - ${semaine.dateCreation}</h4>
                            <button class="btn" onclick="toggleDetailsSemaine(${semaine.numero})" style="padding: 8px 16px; font-size: 0.9rem;">
                                Voir D√©tails
                            </button>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h4>Ventes</h4>
                                <div class="value">${semaine.totalVentes}</div>
                            </div>
                            <div class="stat-card">
                                <h4>Chiffre d'Affaires</h4>
                                <div class="value">${semaine.chiffredAffaires.toFixed(2)} ‚Ç¨</div>
                            </div>
                            <div class="stat-card">
                                <h4>B√©n√©fices</h4>
                                <div class="value">${semaine.beneficesTotaux.toFixed(2)} ‚Ç¨</div>
                            </div>
                            <div class="stat-card">
                                <h4>Marge Moyenne</h4>
                                <div class="value">${semaine.margeMoyenne.toFixed(1)}%</div>
                            </div>
                        </div>
                        
                        <div id="details-semaine-${semaine.numero}" style="display: none; margin-top: 20px;">
                            <h5>D√©tail des Ventes :</h5>
                            <table style="margin-top: 10px;">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>N¬∞ Suivi</th>
                                        <th>Arme</th>
                                        <th>Client</th>
                                        <th>Prix Vente</th>
                                        <th>B√©n√©fice</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                semaine.ventes.forEach(vente => {
                    const profitClass = vente.benefice >= 0 ? 'profit-positive' : 'profit-negative';
                    html += `
                        <tr>
                            <td>${vente.date}</td>
                            <td>${vente.numSuivi || '-'}</td>
                            <td>${vente.arme}</td>
                            <td>${vente.client}</td>
                            <td>${vente.prixVente.toFixed(2)} ‚Ç¨</td>
                            <td class="${profitClass}">${vente.benefice.toFixed(2)} ‚Ç¨</td>
                        </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function toggleDetailsSemaine(numeroSemaine) {
            const details = document.getElementById(`details-semaine-${numeroSemaine}`);
            const isVisible = details.style.display !== 'none';
            details.style.display = isVisible ? 'none' : 'block';
            
            const button = details.previousElementSibling.querySelector('button');
            button.textContent = isVisible ? 'Voir D√©tails' : 'Masquer D√©tails';
        }
    </script>
</body>
</html>